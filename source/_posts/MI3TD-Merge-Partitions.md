---
title: MI3TD 调整系统分区/合并分区 支持 64G 支持官方 OTA【存档】
date: 2018-04-07 15:13:41
categories:
  - Tips
tags:
  - 小米
  - pisces
  - Android
---

## 这是什么
{% note info %}
If you want to see English Version of this post, you can go here: {% exturl "Adjust the system partition & Merge partitions of Mi3TD-Support offical OTA" http://en.miui.com/thread-256334-1-1.html "Xiaomi MIUI Official Forum" %}
{% endnote %}
这是一篇可以指导你将你的小米 3 TD 调整系统分区/合并分区的教程，支持 16G 和 64G 的 TD。

* 有时候你想安装软件，提示你空间不足，去查看一下明明剩余空间还多。
* 有时候你想刷 Gapps 包，却因为系统分区空间不够而刷不进去。

遇到以上这些情况，就需要本文的教程来解决问题了。

可能你看过许多相关帖子，不过方法都不太完美，官方合并分区方法有 BUG，合并之后存储空间会缺失一个多 G，只有 12.25G 大小，而本教程则完美解决了官方合并分区的 BUG，合并之后存储空间全部利用，不再丢失一个 G。<!--more-->

这是合并之后的效果图，此外本教程合并分区之后可以使用官方的系统更新，亲测 OTA 正常。下图是我的手机效果图。
{% img /uploads/2018/04/1.png 540 %}
{% img /uploads/2018/04/2.png 540 %}

## 声明/注意事项
在开始操作之前，建议通读本教程全文，之后再进行操作。
{% note danger %}
并且一定要注意备份数据！
请确保手机电量充足！
刷机与风险并存，需要有失败的心理准备。
{% endnote %}
{% note warning %}
本教程乃个人经验的总结，并不代表百分之百可以成功。
本人对刷机失败变砖等后果概不负责。
{% endnote %}
此刷机教程核心内容由 @Xuefer 提供，这篇教程也在 Xuefer 的指导下完成。

## 准备工作/安装驱动
{% note default %}
所需工具包的下载：{% exturl MiFlash http://bigota.d.miui.com/tools/MiPhone20151028.exe MiFlash %}，{% exturl NvFlash https://pan.baidu.com/s/1nvyEcw5#list/path=/Xuefer%27sAndroid/MI3TD(小米3移动)/nvflash NvFlash %}。
NvFlash 是由 Xuefer 提供的提取自官方线刷包的工具包（米3TD的合并分区隐藏在线刷包里），修复了官方以前的BUG。
{% endnote %}

我所用的电脑系统是 Windows 10 Pro，默认是开启了驱动程序强制签名验证的，然而英伟达（小米）提供的驱动却不包含签名。这就造成了一个很蛋疼的事情，系统默认不允许安装驱动。但是不建议使用比较老的系统，比如 XP，不会自动安装 MTP 驱动，而 MTP 驱动在 XP 上面的安装比较麻烦，建议用 Windows 7 及以上的系统操作。
{% note info %}
Windows 10 的关闭驱动程序强制签名验证的方法如下：
开始 - 设置 - 更新和安全 - 恢复 - 高级启动 立即重启 - 疑难解答 - 高级选项 - 启动设置 - 重启 - 7（禁用驱动程序强制签名验证）
如果不理解可以百度找一找更为详细的带图教程。（Windows 7/8/8.1 请自行百度）
{% endnote %}
在开始之前，请把电脑上的各种软件管家助手都彻底退出，包括杀毒软件和 360 卫士这样的软件，后台程序越少越好，这是为了确保驱动可以正常安装！如果不退出彻底可能会导致后面操作失败。

首先安装 MiFlash，一路默认，不要修改安装地址。如果提示驱动不安全，不要犹豫，仍然安装！
然后解压下载好的 NvFlash 压缩包，里面可以看到这些文件：
![NvFlash](/uploads/2018/04/3.png)
到这里，准备工作就完成了。

## 安装 APX 驱动
{% note danger %}
本教程正常情况下是不会丢失系统、应用这些数据，只丢失照片音乐等数据（即电脑上看到的内容），但刷机有风险，建议备份。
{% endnote %}
首先手机进入 Recovery 模式，注意这里手机要使用第三方的 Recovery（如果你没有使用第三方 Recovery，强烈建议使用 Xuefer 的 TWRP），手机连接电脑，然后电脑双击打开 ``1.双击我进入APX模式.bat`` ，会有以下提示：
![双击我进入 APX 模式](/uploads/2018/04/4.png)
如果你的提示不是这样的，而是类似这样的：
```
adb server is out of date.  killing...
ADB server didn't ACK
* failed to start daemon *
error: unknown host service
```
说明你的电脑里已经在运行 ``adb.exe``，请进入任务管理器，把所有的 ``adb.exe`` 结束，再打开 ``1.双击我进入APX模式.bat`` ，基本就会正常了。

此时在设备管理器中可以看到有这么个设备：
![设备管理器](/uploads/2018/04/5.png)
右键点击 APX（如果没有找到 APX，请看最下面的提示），更新驱动程序软件，浏览计算机以查找驱动程序软件，浏览文件夹，定位到刚刚下载的解压好的文件夹，选择 APX-Driver，点击确定：
![更新驱动程序软件](/uploads/2018/04/6.png)
点击下一步会出现如下提示：
![Windows 安全](/uploads/2018/04/7.png)
此时点击 始终安装此驱动程序软件 ，安装完成之后在设备管理器中可以看到这样一个设备：
![设备管理器](/uploads/2018/04/8.png)
到这里，APX 的驱动安装完成。

更新：根据 @安399042134 的反馈：
{% quote %}有些人不知道为什么已经有驱动了(我也遇到了，不知道哪来的驱动，接上去就有)，所以进去深度刷机时，没有显示APX，而是出现在nvidia boot recovery里{% endquote %}
所以，如果你找不到 APX 设备请不要慌张，可能不知道那个软件已经帮你安装好了。直接确认最后一个图就好了。

## 开始分区
接下来，电脑上双击打开 ``2.双击我选择分区方案.bat`` ，这里提供了多种方案（以你下载的文件为准）：
{% note default %}
1. 旧版 MIUI 方案: 双系统, 应用/存储分离
2. 新版 MIUI 方案: 双系统, 应用/存储合并 (已修正官方 bug 不丢 1GB)
3. 单系统方案: 在 2 的基础上 缩小 系统二 扩大 系统一
4. 自定义配置: 按照自己的需求来修改分区
{% endnote %}
这里解释下每个选项：
{% note default %}
1. 相当于调整手机分区到刚出厂的状态。
2. 合并分区。有时候你想安装软件，提示你空间不足，去查看一下明明剩余空间还多，那么就选择这个。
3. 这个是给那些不想要双系统，或者是需要更大的系统分区的同学准备的。如果你想刷入 Gapps 包，却苦恼于空间不足，那么就选择这个。但是有一点，这样做之后系统二将变为不可用。
4. 自定义配置。如果你不知道 MB 与 MiB 的区别，以及 CAC、LNX、LN1 这些词的意思，就千万不要用这个。建议大多数人都不要选这个。
{% endnote %}
无论选择哪个，之后都会出现以下界面：
![开始分区](/uploads/2018/04/9.png)
这就是正在分区了，等它这些东西走完，窗口会自动关闭，手机会自动开机。此时长按电源键强制重启，屏幕黑下来就按住音量 + 直到进入 Recovery，首次进入 Recovery（也许）会询问你是否保持 System 分区只读，此时选中 重启时不再显示本信息，然后滑动下方的滑块，允许修改，手机继续保持与电脑连接。

如果你选择了方案一，此时将卡刷包复制到手机中即可以刷机使用。

如果你使用了方案二或三，此时在 Recovery 里进行一下操作：
{% img /uploads/2018/04/10.png 540 %}
{% img /uploads/2018/04/11.png 540 %}
{% img /uploads/2018/04/12.png 540 %}
{% img /uploads/2018/04/13.png 540 %}
{% img /uploads/2018/04/14.png 540 %}
之后尝试开机。
正常情况下系统、软件都在，照片音乐丢失。教程结束。

如果原来没有自己调整过分区，使用方案二或方案三分区一般是不丢失数据的。

如果运气不好，发生了一些异常情况：比如无法正常开机、软件闪退、剩余存储空间不对，那么，请看下面的步骤进行格式化分区。（正常情况下 MIUI 稳定版/开发版中显示为 13.46G，电脑/CM/MIUI 体验版显示为 12.5G，MIUI 体验版调整了计量单位为 GiB 但是仍显示为 GB，对这些有疑问的可以去看看知乎：{% exturl "KB / KiB，MB / MiB，GB / GiB，… 的区别是什么？" https://www.zhihu.com/question/24601215 "知乎" %}）

## 格式化分区
这时手机是在 Recovery 的状态：
{% img /uploads/2018/04/10.png 540 %}
{% img /uploads/2018/04/16.png 540 %}
输入“yes”，点击 蓝色 对勾：
{% img /uploads/2018/04/17.png 540 %}
即可完成格式化。

到这里，即可以刷机使用。个人不推荐各种形式的线刷，最好使用卡刷包。如果线刷出了问题无法解决，可以按照本教程再来一次。
{% note warning %}
方案三的同学，请注意！
你们选择的方案是扩大了系统一，但是如果遇到了还是不能刷入 Gapps 包，或者看到系统分区很小（一般这种情况是发生在刷 5.0 以上系统的时候），那么需要进行一下额外的操作，请继续往下看。
{% endnote %}

## 方案三需注意
一般来说，刷完系统包之后，再尝试着刷入稍微大点的 Gapps 包就会提醒你空间不足。
然而，这个不足并不是真的不足，而是系统分区信息还没有“更新”。

在刷完系统包之后，先别急着刷其他包，回到 Recovery 主界面，按照以下操作走一遍：
{% img /uploads/2018/04/10.png 540 %}
{% img /uploads/2018/04/11.png 540 %}
{% img /uploads/2018/04/17.png 540 %}
{% img /uploads/2018/04/18.png 540 %}
{% img /uploads/2018/04/19.png 540 %}
{% img /uploads/2018/04/20.png 540 %}
此时就可以刷入 Gapps 了。
{% note warning %}
方案三比较特殊，使用了方案三之后，不可再使用官方的系统更新 APP 进行更新，会发生未知的严重后果。想更新可以下载 OTA 包或者完整卡刷包在 TWRP（Recovery）内刷入更新。
{% endnote %}