---
title: 最强日期正则表达式
date: 2019-03-13 21:24:27
categories:
  - Tips
tags:
  - 正则表达式
author: 天秤水
url: https://www.cnblogs.com/jay-xu33/archive/2009/01/08/1371953.html
---

## 简单的日期判断（YYYY/MM/DD）

```
^\d{4}(\-|\/|\.)\d{1,2}\1\d{1,2}$
```

## 演化的日期判断（YYYY/MM/DD| YY/MM/DD）
 
```
^(^(\d{4}|\d{2})(\-|\/|\.)\d{1,2}\3\d{1,2}$)|(^\d{4}年\d{1,2}月\d{1,2}日$)$
```

## 加入闰年的判断
```
^((((1[6-9]|[2-9]\d)\d{2})-(0?[13578]|1[02])-(0?[1-9]|[12]\d|3[01]))|(((1[6-9]|[2-9]\d)\d{2})-(0?[13456789]|1[012])-(0?[1-9]|[12]\d|30))|(((1[6-9]|[2-9]\d)\d{2})-0?2-(0?[1-9]|1\d|2[0-8]))|(((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))-0?2-29-))$
```
<!--more-->
## 分析

首先需要验证年份，显然，年份范围为 0001-9999，匹配 YYYY 的正则表达式为：`[0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3}`
其中 `[0-9]` 也可以表示为 `\d`，但 `\d` 不如 `[0-9]` 直观，因此下面我将一直采用 `[0-9]`

用正则表达式验证日期的难点有二：一是大小月份的天数不同，二是闰年的考虑。
对于第一个难点，我们首先不考虑闰年，假设 2 月份都是 28 天，这样，月份和日期可以分成三种情况：

1. 月份为 1、3、5、7、8、10、12，天数范围为 01-31，匹配 MM-DD 的正则表达式为：`(0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01])`
2. 月份为 4、6、9、11，天数范围为 01-30，匹配 MM-DD 的正则表达式为：`(0[469]|11)-(0[1-9]|[12][0-9]|30)`
3. 月份为 2，考虑平年情况，匹配 MM-DD 的正则表达式为：`02-(0[1-9]|[1][0-9]|2[0-8])`

根据上面的成果，我们可以得到匹配平年日期格式为 YYYY-MM-DD 的正则表达式：
```
([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8])))
```

接着我们来解决第二个难点：闰年的考虑。根据闰年的定义，我们可以将闰年分为两类：

1. 能被4整除但不能被100整除的年份。寻找后两位的变化规律，可以很快得到下面的正则匹配：`([0-9]{2})(0[48]|[2468][048]|[13579][26])`
2. 能被400整除的年份。能被400整除的数肯定能被100整除，因此后两位肯定是00，我们只要保证前两位能被4整除即可，相应的正则表达式为：`(0[48]|[2468][048]|[3579][26])00`

## 最强验证日期的正则表达式

这个日期正则表达式支持
```
YYYY-MM-DD 
YYYY/MM/DD 
YYYY_MM_DD 
YYYY.MM.DD
```
这些形式。

完整的正则表达式如下:
```
((^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(10|12|0?[13578])([-\/\._])(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(11|0?[469])([-\/\._])(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(0?2)([-\/\._])(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([3579][26]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][13579][26])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][13579][26])([-\/\._])(0?2)([-\/\._])(29)$))
```
